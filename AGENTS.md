# Repository Guidelines

## Overview
- **Project**: SpaghettiKart, a fan port of *Mario Kart 64* targeting modern platforms.
- **Primary Languages**: C (gameplay/engine code in `src/`), C++20 (platform layer in `libultraship/`), and a small amount of MIPS assembly generated through CMake for Nintendo 64 compatibility layers.
- **Build System**: CMake with support for Ninja, Visual Studio 2022, Xcode, and other generators. Assets are produced through custom extract/convert targets driven by the build.

## High-Level Structure
- `src/`: Core gameplay sources organised by subsystem (audio, rendering, racing logic, networking, enhancements, etc.). Files follow a decompiled naming convention (`code_########.c`) alongside descriptive modules.
- `include/`: Public headers and shared data definitions used by both the engine code and the `libultraship` platform layer.
- `libultraship/`: Submodule containing the cross-platform runtime, rendering backends, platform abstraction, and integration utilities.
- `assets/`, `mods/`, `courses/`, `yamls/`, `models/`: Game asset archives, extracted resources, and configuration files expected or generated by tooling.
- `cmake/`, `cmake/modules/`, `lus-cvars.cmake`: Custom build logic for options, toolchain helpers, and libultraship configuration.
- `tools/`, `python_convert.py`, `extract_assets.py`, `progress.py`: Utility scripts for asset extraction/conversion and project maintenance.
- `android/`, `port/`: Platform-specific build glue (Android project files, platform abstraction code).
- `docs/`: Developer documentation including detailed build instructions (`docs/BUILDING.md`).

## Dependencies
- Managed via `vcpkg.json`; key libraries include SDL2/SDL2-net (input/networking), OpenGL loaders (GLEW/GLFW), compression (zlib, bzip2, libzip), media codecs (libpng, libogg, libvorbis), logging (spdlog), and serialization libraries (nlohmann-json, tinyxml2).
- Additional platform requirements documented in `docs/BUILDING.md` (e.g., toolchains, ninja, cmake, platform SDKs).
- The build expects a legal US ROM to generate `mk64.o2r` assets through the `ExtractAssets` target before the executable can run.

## Build & Testing Notes
- Typical desktop workflow:
  - Initialise submodules: `git submodule update --init`.
  - Configure: `cmake -S . -B build-cmake -GNinja` (or Visual Studio/Xcode equivalents).
  - Generate assets: `cmake --build build-cmake --target ExtractAssets` (requires ROM placement per README instructions).
  - Compile: `cmake --build build-cmake`.
- Windows developers commonly use the Visual Studio 2022 generator with the v143 toolset; Linux/macOS instructions cover package managers for dependencies.
- Distributables can be produced with CPack (`cmake --build â€¦ --target package` or direct `cpack` invocations) after a successful build.

## Code Style Expectations
- C code targets C11 with four-space indentation and brace-on-same-line conventions (`void func(void) { ... }`).
- C++ components in `libultraship/` follow modern C++20 practices provided by the submodule; consult that directory for additional conventions.
- Avoid introducing `try/catch` around includes or violating the existing compilation defines described in `CMakeLists.txt`.
- Many symbols and file names mirror original game labels; preserve naming patterns unless performing a coordinated refactor.

## Additional Tips
- Asset-heavy targets (`ExtractAssets`, `GenerateO2R`) are required for first-time setup; cache results if possible to speed up iteration.
- Networking features depend on `sdl2-net`; ensure the dependency is available when testing multiplayer components.
- When editing files under `libultraship/`, review that submodule's own documentation for platform-specific constraints.
